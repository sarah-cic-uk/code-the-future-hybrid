<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="keywords" content="Code, Future, HTML, CSS, JavaScript, IBM, CIC" />
  <meta name="description" content="Code the Future free HTML/CSS coding bootcamp" />

  <title>Code the Future</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous" />

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" />

  <script src="../../js/sidenav.js" type="text/javascript" defer></script>
  <script type="text/javascript" src="../../js/app.js"></script>
  <script src="../../js/imports.js"></script>

  <style>
    .mimic-iframe-body {
      margin: 0px 30px;
    }

    h2 {
      display: block;
      font-size: 1.5em;
      margin-block-start: 0.83em;
      margin-block-end: 0.83em;
      margin-inline-start: 0px;
      margin-inline-end: 0px;
      font-weight: bold;
    }

    .btn-tertiary {
      background-color: #d9437a;
      color: white;
      padding: 0.5rem 1.5rem;
      border: 0;
      border-radius: 0.4rem !important;
    }

    .btn-tertiary:hover {
      background-color: #d9437a;
      color: white;
      opacity: 70%;
    }

    .container {
      margin: 0 !important;
    }

    .pagination-container .btn {
      margin: 0.2rem;
      border-color: transparent;
    }

    .pagination-container .btn.active {
      background-color: #d9437a;
      color: white;
      opacity: 70%;
    }

    .pagination-container .btn.active:hover {
      background-color: #d9437a;
      color: white;
      cursor: none;
      pointer-events: none;
    }

    .pagination-container .btn-outline-tertiary:hover {
      background-color: #d9437a;
      color: white;
    }
  </style>
</head>

<body>
  <div class="page-body">
    <nav class="navbar navbar-expand-lg bg-light">
      <div class="container-fluid g-0">
        <a onclick="createPath('index.html')" class="navbar-brand" href="#" style="
              border-right: 2px solid #d9437a;
              padding-right: 10px;
              color: #1d0c59;
            ">
          <img src="../../../images/logo.png" height="60px" />
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup"
          aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-between" id="navbarNavAltMarkup">
          <div class="navbar-nav nav-justified">
            <button class="nav-link border-end border-dark" name="session1-nav" aria-current="page"
              onclick="createPath('pages/sessions/session1/introduction.html')">
              Session 1
              <span id="session1-tooltip" class="box tooltip-text hidden">Session Opens Soon</span>
            </button>
            <button class="nav-link border-end border-dark" name="session2-nav" aria-current="page"
              onclick="createPath('pages/sessions/session2/introduction.html')">
              Session 2
              <span id="session2-tooltip" class="box tooltip-text hidden">Session Opens Soon</span>
            </button>
            <button class="nav-link border-end border-dark" name="session3-nav" aria-current="page"
              onclick="createPath('pages/sessions/session3/introduction.html')">
              Session 3
              <span id="session3-tooltip" class="box tooltip-text hidden">Session Opens Soon</span>
            </button>
            <button class="nav-link border-end border-dark" name="session4-nav" aria-current="page"
              onclick="createPath('pages/sessions/session4/introduction.html')">
              Session 4
              <span id="session4-tooltip" class="box tooltip-text hidden">Session Opens Soon</span>
            </button>
            <button class="nav-link border-end border-dark" name="session5-nav" aria-current="page"
              onclick="createPath('pages/sessions/session5/introduction.html')">
              Session 5
              <span id="session5-tooltip" class="box tooltip-text hidden">Session Opens Soon</span>
            </button>
            <button class="nav-link border-end border-dark" name="showcase-nav" aria-current="page"
              onclick="createPath('pages/sessions/session6/introduction.html')">
              Showcase
              <span id="showcase-tooltip" class="box tooltip-text hidden">Session Opens Soon</span>
            </button>
          </div>
          <div class="d-flex align-items-center" div id="profile-button">
            <!-- Logged in Avatar -->
            <div>
              <p class=" my-auto" id="profileName">
              </p>
            </div>
            <div class="profileBtn dropdown px-3">
              <a class="btn dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown"
                aria-expanded="false">
                <img id="profile-pic-avatar" class="rounded-circle" height="25" alt=""
                  loading="lazy" />
              </a>

              <ul class="dropdown-menu dropdown-menu-end" aria-labelledby=" dropdownMenuLink">
                <li>
                  <a class="dropdown-item" href="#" onclick="createPath('pages/profile.html')">My Profile</a>
                </li>
                <li>
                  <a class="dropdown-item" href="#" onclick="createPath('pages/cohort.html')">View Cohort</a>
                </li>
                <li>
                  <a class="dropdown-item" href="#" onclick="logUserOut()">Log out</a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <div class="container-fluid">
      <div class="row flex-nowrap page-content">
        <div class="col py-3">
          <div class="mimic-iframe-body">
            <div class="row">
              <section>
                <h2>Previous showcase</h2>
                <p>Wow, what an incredible journey it's been over the past weeks! You've navigated the course with
                  dedication and created some truly outstanding work. Take a moment to celebrate everything you've
                  achievedâ€”you should be so proud!</p>

                <p>If you'd like to share your project with future Code the Future cohorts, simply update your profile
                  settings to allow it. And while you're here, explore some of the incredible projects from previous
                  cohorts; you might find some fresh ideas and inspiration to takeaway with you!</p>
              </section>
            </div>

            <div class="container pt-4 mb-4">
              <div class="row card-container">
                <!-- dynamic showcase -->
              </div>
            </div>

          </div>
          <div id="session-navigation"></div>
        </div>
      </div>
    </div>
  </div>

  <script type="text/javascript">
    const stylesheet = document.createElement("link");
    stylesheet.rel = "stylesheet";
    stylesheet.type = "text/css";
    stylesheet.href = getPath() + "styles/mainStyle.css";
    document.head.appendChild(stylesheet);

    const itemsPerPage = 6;
    let currentPage = 1;

    async function loadStudentShowcases(page = 1) {
      const showcaseContainer = document.querySelector(".card-container");
      showcaseContainer.innerHTML = "";
      currentPage = page;

      const studentsRef = window.fbDB.ref('/users');
      const snapshot = await studentsRef.once("value");
      const students = [];

      snapshot.forEach((childSnapshot) => {
        const student = childSnapshot.val();
        if (student.profile && student.profile.siteFlag === true) {
          students.push({ ...student, userId: childSnapshot.key });
        }
      });

      const totalPages = Math.ceil(students.length / itemsPerPage);
      const startIndex = (page - 1) * itemsPerPage;
      const endIndex = startIndex + itemsPerPage;
      const paginatedStudents = students.slice(startIndex, endIndex);

      paginatedStudents.forEach((student) => {
        const cardHTML = `
          <div class="col-lg-4 col-md-6 col-sm-12">
            <div class="card shadow m-2" style="height: fit-content;">
              <div class="card-body">
                <p class="h5 mt-1 text-center"><strong>${student.displayName}</strong></p>
                <div class="d-flex justify-content-center">
                  <img class="profile-pic rounded-circle img-thumbnail" style="height: 200px; width: 200px;"
                    src="https://avatar.iran.liara.run/public" 
                    alt="Profile picture of ${student.displayName}" data-user-id="${student.userId}" />
                </div>
                <div class="text-center my-6">
                  <p class="d-block h6 mt-4">${student.profile.siteTitle || 'Project Title'}</p>
                  <a href="https://${student.profile.siteURL}" class="btn btn-tertiary mt-2" target="_blank">View project</a>
                </div>
              </div>
            </div>
          </div>
        `;

        showcaseContainer.innerHTML += cardHTML;
        setUserProfileImage(student.userId, student.profile.imageURL);
      });

      renderPaginationControls(totalPages);
    }

    function renderPaginationControls(totalPages) {
      const paginationContainer = document.createElement("div");
      paginationContainer.className = "pagination-container text-center mt-4";

      for (let i = 1; i <= totalPages; i++) {
        const pageButton = document.createElement("button");
        pageButton.className = "btn btn-outline-tertiary mx-1";
        pageButton.textContent = i;
        pageButton.onclick = () => loadStudentShowcases(i);
        if (i === currentPage) pageButton.classList.add("active");
        paginationContainer.appendChild(pageButton);
      }

      document.querySelector(".pagination-container")?.remove();
      document.querySelector(".container.pt-4.mb-4").appendChild(paginationContainer);
    }

    async function setUserProfileImage(userId, fallbackImageURL) {
      const imgElement = document.querySelector(`img[data-user-id="${userId}"]`);

      if (imgElement) {
        const pathReference = window.fbStorage.ref("profilePics/" + userId);

        try {
          const url = await pathReference.getDownloadURL();
          console.log(`Using Firebase Storage image for user ${userId}: ${url}`);
          imgElement.src = url; // set the Firebase Storage image IF available
        } catch (error) {
          if (error.code === 'storage/object-not-found') {
            if (fallbackImageURL) {
              imgElement.src = fallbackImageURL; // use the `imageURL` from Firebase IF available
              console.log(`Using fallback imageURL for user ${userId}: ${fallbackImageURL}`);
            } else {
              imgElement.src = "https://avatar.iran.liara.run/public"; // default image IF neither are available
              console.log(`Using default image for user ${userId}`);
            }
          } else {
            console.error(`Error fetching profile image for user ${userId}:`, error);
          }
        }
      }
    }

    window.onload = () => {
      loadStudentShowcases();
      checkReleaseDates(window.fbDB);
      auth(null, document.querySelector(".profileBtn"), document.querySelector("#sessionsLink"));
      updateSideNavOverview();
    };

    function createPath(options) {
      window.location = getPath() + options;
      return false;
    }

    function logUserOut(event) {
      logout(window.fbAuth);
    }
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
    crossorigin="anonymous"></script>

  <script type="module">
    import { fbAuth, fbStorage, fbDB } from "../../js/firebase.js";
    window.fbAuth = fbAuth;
    window.fbDB = fbDB;
    window.fbStorage = fbStorage;
  </script>
  <script defer="" src="../../js/sessionNavigation.js"></script>
</body>

</html>